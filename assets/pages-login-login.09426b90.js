import{c as e,f as t,b as a,n as r,t as n,p as l,P as s,w as o,Q as i,R as u,F as c,C as d,O as m,a as g,m as p,h as f,l as v,k as h,y as b,S as y,d as w,v as S,U as V,V as x,I as k,W as B,_ as I}from"./index.daaf9893.js";import{B as C}from"./index.1d067866.js";import{c as M,a as A,C as E}from"./index.1a0d1182.js";import{C as P,f as T,b as $,m as j,g as W,p as z,y as F,h as L,l as U,k as q,A as O,M as D,H,I as R,O as _,K,o as Q,c as G,w as J,e as N}from"./index-9c365a03.js";let X=0;const[Y,Z]=e("form");const ee=o(T({name:Y,props:{colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:r,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:n,showErrorMessage:n,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}},emits:["submit","failed"],setup(e,{emit:r,slots:n}){const{children:o,linkChildren:i}=t(s),u=e=>e?o.filter((t=>e.includes(t.name))):o,c=t=>{return"string"==typeof t?(e=>{const t=o.find((t=>t.name===e));return t?new Promise(((e,a)=>{t.validate().then((t=>{t?a(t):e()}))})):Promise.reject()})(t):e.validateFirst?(a=t,new Promise(((e,t)=>{const r=[];u(a).reduce(((e,t)=>e.then((()=>{if(!r.length)return t.validate().then((e=>{e&&r.push(e)}))}))),Promise.resolve()).then((()=>{r.length?t(r):e()}))}))):(e=>new Promise(((t,a)=>{const r=u(e);Promise.all(r.map((e=>e.validate()))).then((e=>{(e=e.filter(Boolean)).length?a(e):t()}))})))(t);var a},d=(e,t)=>{o.some((a=>a.name===e&&(a.$el.scrollIntoView(t),!0)))},m=()=>o.reduce(((e,t)=>(void 0!==t.name&&(e[t.name]=t.formValue.value),e)),{}),g=()=>{const t=m();c().then((()=>r("submit",t))).catch((a=>{r("failed",{values:t,errors:a}),e.scrollToError&&a[0].name&&d(a[0].name)}))},p=e=>{l(e),g()};return i({props:e}),a({submit:g,validate:c,getValues:m,scrollToField:d,resetValidation:e=>{"string"==typeof e&&(e=[e]);u(e).forEach((e=>{e.resetValidation()}))},getValidationStatus:()=>o.reduce(((e,t)=>(e[t.name]=t.getValidationStatus(),e)),{})}),()=>{var e;return $("form",{class:Z(),onSubmit:p},[null==(e=n.default)?void 0:e.call(n)])}}}));function te(e){return Array.isArray(e)?!e.length:0!==e&&!e}function ae(e,t){const{message:a}=t;return d(a)?a(e,t):a||""}function re({target:e}){e.composing=!0}function ne({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function le(e){return[...e].length}function se(e,t){return[...e].slice(0,t).join("")}const[oe,ie]=e("field");const ue=o(T({name:oe,props:f({},M,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:r,formatter:Function,clearIcon:g("clear"),modelValue:p(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:g("focus"),formatTrigger:g("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},{rows:r,type:g("text"),rules:Array,autosize:[Boolean,Object],labelWidth:r,labelClass:v,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:t,slots:r}){const n=function(){const e=P(),{name:t="unknown"}=(null==e?void 0:e.type)||{};return`${t}-${++X}`}(),o=j({status:"unvalidated",focused:!1,validateMessage:""}),d=W(),g=W(),p=W(),{parent:f}=h(s),v=()=>{var t;return String(null!=(t=e.modelValue)?t:"")},I=t=>S(e[t])?e[t]:f&&S(f.props[t])?f.props[t]:void 0,C=z((()=>{const t=I("readonly");if(e.clearable&&!t){const t=""!==v(),a="always"===e.clearTrigger||"focus"===e.clearTrigger&&o.focused;return t&&a}return!1})),M=z((()=>p.value&&r.input?p.value():e.modelValue)),E=e=>e.reduce(((e,t)=>e.then((()=>{if("failed"===o.status)return;let{value:e}=M;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(te(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return o.status="failed",void(o.validateMessage=ae(e,t));if(t.validator){if(te(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise((a=>{const r=t.validator(e,t);c(r)?r.then(a):a(r)}))}(e,t).then((a=>{a&&"string"==typeof a?(o.status="failed",o.validateMessage=a):!1===a&&(o.status="failed",o.validateMessage=ae(e,t))}))}}))),Promise.resolve()),T=()=>{o.status="unvalidated",o.validateMessage=""},H=()=>t("endValidate",{status:o.status,message:o.validateMessage}),R=(a=e.rules)=>new Promise((r=>{T(),a?(t("startValidate"),E(a).then((()=>{"failed"===o.status?(r({name:e.name,message:o.validateMessage}),H()):(o.status="passed",r(),H())}))):r()})),_=t=>{if(f&&e.rules){const{validateTrigger:a}=f.props,r=V(a).includes(t),n=e.rules.filter((e=>e.trigger?V(e.trigger).includes(t):r));n.length&&R(n)}},K=(a,r="onChange")=>{const n=a;a=(t=>{var a;const{maxlength:r}=e;if(S(r)&&le(t)>+r){const e=v();if(e&&le(e)===+r)return e;const n=null==(a=d.value)?void 0:a.selectionEnd;if(o.focused&&n){const e=[...t],a=e.length-+r;return e.splice(n-a,a),e.join("")}return se(t,+r)}return t})(a);const l=le(n)-le(a);if("number"===e.type||"digit"===e.type){const t="number"===e.type;a=x(a,t,t)}let s=0;if(e.formatter&&r===e.formatTrigger){const{formatter:t,maxlength:r}=e;if(a=t(a),S(r)&&le(a)>+r&&(a=se(a,+r)),d.value&&o.focused){const{selectionEnd:e}=d.value,a=se(n,e);s=le(t(a))-le(a)}}if(d.value&&d.value.value!==a)if(o.focused){let{selectionStart:e,selectionEnd:t}=d.value;if(d.value.value=a,S(e)&&S(t)){const r=le(a);l?(e-=l,t-=l):s&&(e+=s,t+=s),d.value.setSelectionRange(Math.min(e,r),Math.min(t,r))}}else d.value.value=a;a!==e.modelValue&&t("update:modelValue",a)},Q=e=>{e.target.composing||K(e.target.value)},G=()=>{var e;return null==(e=d.value)?void 0:e.blur()},J=()=>{var e;return null==(e=d.value)?void 0:e.focus()},N=()=>{const t=d.value;"textarea"===e.type&&e.autosize&&t&&function(e,t){const a=i();e.style.height="auto";let r=e.scrollHeight;if(m(t)){const{maxHeight:e,minHeight:a}=t;void 0!==e&&(r=Math.min(r,e)),void 0!==a&&(r=Math.max(r,a))}r&&(e.style.height=`${r}px`,u(a))}(t,e.autosize)},Y=e=>{o.focused=!0,t("focus",e),U(N),I("readonly")&&G()},Z=e=>{o.focused=!1,K(v(),"onBlur"),t("blur",e),I("readonly")||(_("onBlur"),U(N),B())},ee=e=>t("clickInput",e),oe=e=>t("clickLeftIcon",e),ue=e=>t("clickRightIcon",e),ce=z((()=>"boolean"==typeof e.error?e.error:!(!f||!f.props.showError||"failed"!==o.status)||void 0)),de=z((()=>{const e=I("labelWidth"),t=I("labelAlign");if(e&&"top"!==t)return{width:b(e)}})),me=a=>{if(13===a.keyCode){f&&f.props.submitOnEnter||"textarea"===e.type||l(a),"search"===e.type&&G()}t("keypress",a)},ge=()=>e.id||`${n}-input`,pe=()=>{const t=ie("control",[I("inputAlign"),{error:ce.value,custom:!!r.input,"min-height":"textarea"===e.type&&!e.autosize}]);if(r.input)return $("div",{class:t,onClick:ee},[r.input()]);const a={id:ge(),ref:d,name:e.name,rows:void 0!==e.rows?+e.rows:void 0,class:t,disabled:I("disabled"),readonly:I("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,enterkeyhint:e.enterkeyhint,"aria-labelledby":e.label?`${n}-label`:void 0,onBlur:Z,onFocus:Y,onInput:Q,onClick:ee,onChange:ne,onKeypress:me,onCompositionend:ne,onCompositionstart:re};return"textarea"===e.type?$("textarea",a,null):$("input",O("number"===(l=e.type)?{type:"text",inputmode:"decimal"}:"digit"===l?{type:"tel",inputmode:"numeric"}:{type:l},a),null);var l},fe=()=>{const t=r["right-icon"];if(e.rightIcon||t)return $("div",{class:ie("right-icon"),onClick:ue},[t?t():$(k,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},ve=()=>{if(e.showWordLimit&&e.maxlength){const t=le(v());return $("div",{class:ie("word-limit")},[$("span",{class:ie("word-num")},[t]),D("/"),e.maxlength])}},he=()=>{if(f&&!1===f.props.showErrorMessage)return;const t=e.errorMessage||o.validateMessage;if(t){const e=r["error-message"],a=I("errorMessageAlign");return $("div",{class:ie("error-message",a)},[e?e({message:t}):t])}},be=()=>[$("div",{class:ie("body")},[pe(),C.value&&$(k,{ref:g,name:e.clearIcon,class:ie("clear")},null),fe(),r.button&&$("div",{class:ie("button")},[r.button()])]),ve(),he()];return a({blur:G,focus:J,validate:R,formValue:M,resetValidation:T,getValidationStatus:()=>o.status}),F(y,{customValue:p,resetValidation:T,validateWithTrigger:_}),L((()=>e.modelValue),(()=>{K(v()),T(),_("onChange"),U(N)})),q((()=>{K(v(),e.formatTrigger),U(N)})),w("touchstart",(e=>{l(e),t("update:modelValue",""),t("clear",e)}),{target:z((()=>{var e;return null==(e=g.value)?void 0:e.$el}))}),()=>{const t=I("disabled"),a=I("labelAlign"),s=(()=>{const t=r["left-icon"];if(e.leftIcon||t)return $("div",{class:ie("left-icon"),onClick:oe},[t?t():$(k,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])})();return $(A,{size:e.size,class:ie({error:ce.value,disabled:t,[`label-${a}`]:a}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:de.value,valueClass:ie("value"),titleClass:[ie("label",[a,{required:e.required}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:s&&"top"!==a?()=>s:null,title:()=>{const t=(()=>{const t=I("labelWidth"),a=I("labelAlign"),s=I("colon")?":":"";return r.label?[r.label(),s]:e.label?$("label",{id:`${n}-label`,for:r.input?void 0:ge(),onClick:e=>{l(e),J()},style:"top"===a&&t?{width:b(t)}:void 0},[e.label+s]):void 0})();return"top"===a?[s,t].filter(Boolean):t||[]},value:be,extra:r.extra})}}}));const ce=I({name:"login",props:{},components:{},data:()=>({username:"",password:""}),computed:{},methods:{...H(R,{syncUserInfo:"syncUserInfo"}),async getData(){},onSubmit(e){this.confirmSubmit(e)},async confirmSubmit(e){console.log(e);let t={username:e.username,password:e.password};const a=await this.$http.login(t);0==a.code&&(this.$msg.success("登录成功"),_(a.data.token),this.syncUserInfo(),K({url:"/"}))}},created(){this.getData()}},[["render",function(e,t,a,r,n,l){const s=ue,o=E,i=C,u=ee;return Q(),G("div",{class:"",style:{"margin-top":"20px"}},[$(u,{onSubmit:l.onSubmit},{default:J((()=>[$(o,{inset:""},{default:J((()=>[$(s,{modelValue:n.username,"onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),name:"username",label:"用户名",placeholder:"用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),$(s,{modelValue:n.password,"onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),type:"password",name:"password",label:"密码",placeholder:"密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"])])),_:1}),N("div",{style:{margin:"16px"}},[$(i,{round:"",block:"",type:"primary","native-type":"submit"},{default:J((()=>[D(" 提交 ")])),_:1})])])),_:1},8,["onSubmit"])])}]]);export{ce as default};
